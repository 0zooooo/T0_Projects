<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¤ëŠ˜ ë­ ë³¼ê¹Œ? - TMDB ì˜í™” ì¶”ì²œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #0f172a;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: #020617;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
    }

    header {
      margin-bottom: 20px;
    }

    header h1 {
      font-size: 1.8rem;
      margin-bottom: 6px;
    }

    header p {
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    .controls button,
    .controls input {
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      padding: 10px 16px;
      font-size: 0.9rem;
    }

    .controls button {
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
      white-space: nowrap;
    }

    .controls button:hover {
      background: #1f2937;
      transform: translateY(-1px);
    }

    .controls input {
      flex: 1;
      min-width: 160px;
    }

    .status {
      margin: 16px 0 8px;
      font-size: 0.85rem;
      color: #9ca3af;
      min-height: 18px;
    }

    .movies {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 8px;
    }

    .movie-card {
      background: #020617;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #1f2937;
      display: flex;
      flex-direction: column;
      transition: transform 0.15s, box-shadow 0.15s, border-color 0.15s;
    }

    .movie-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
      border-color: #22c55e;
    }

    .movie-poster {
      width: 100%;
      aspect-ratio: 2 / 3;
      object-fit: cover;
      background: #111827;
    }

    .movie-body {
      padding: 12px 14px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }

    .movie-title {
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .movie-meta {
      font-size: 0.8rem;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      border: 1px solid #374151;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .movie-overview {
      margin-top: 4px;
      font-size: 0.8rem;
      color: #d1d5db;
      line-height: 1.4;
      max-height: 4.2em; /* 3ì¤„ ì •ë„ */
      overflow: hidden;
    }

    @media (max-width: 600px) {
      .app {
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>ì˜¤ëŠ˜ ë­ ë³¼ê¹Œ? ğŸ¬</h1>
      <p>TMDB ë¬´ë£Œ ê³µê°œ APIë¥¼ ì´ìš©í•´ì„œ ì¸ê¸° ì˜í™” ì¶”ì²œ & ê²€ìƒ‰ ì›¹ì•±ì„ ë§Œë“  ì˜ˆì œì…ë‹ˆë‹¤.</p>

      <div class="controls">
        <button id="random-btn">ëœë¤ ì¸ê¸° ì˜í™” ì¶”ì²œ</button>
        <button id="popular-btn">ì¸ê¸° ì˜í™” 8ê°œ ë³´ê¸°</button>

        <input
          id="search-input"
          type="text"
          placeholder="ì˜í™” ì œëª© ê²€ìƒ‰ (ì˜ˆ: Inception, ê¸°ìƒì¶©)"
        />
        <button id="search-btn">ê²€ìƒ‰</button>
      </div>
    </header>

    <div id="status" class="status"></div>

    <section id="movies" class="movies"></section>
  </div>

  <script>
    // ====== TMDB ê¸°ë³¸ ì„¤ì • ======
    const API_KEY = 'e1648fe6e90014f18540caf0a2279b76';
    const BASE_URL = 'https://api.themoviedb.org/3';
    const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500'; // í¬ìŠ¤í„° ì´ë¯¸ì§€ ë² ì´ìŠ¤ URL

    const statusEl = document.getElementById('status');
    const moviesEl = document.getElementById('movies');
    const randomBtn = document.getElementById('random-btn');
    const popularBtn = document.getElementById('popular-btn');
    const searchBtn = document.getElementById('search-btn');
    const searchInput = document.getElementById('search-input');

    // ê³µí†µ: ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
    function setStatus(message) {
      statusEl.textContent = message || '';
    }

    // ê³µí†µ: ì¹´ë“œ ë Œë”ë§
    function renderMovies(movies) {
      moviesEl.innerHTML = '';

      if (!movies || movies.length === 0) {
        moviesEl.innerHTML = '<p>ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      movies.forEach((movie) => {
        const card = document.createElement('article');
        card.className = 'movie-card';

        const posterPath = movie.poster_path
          ? IMAGE_BASE + movie.poster_path
          : '';

        const releaseYear = movie.release_date
          ? movie.release_date.slice(0, 4)
          : 'ì—°ë„ ì •ë³´ ì—†ìŒ';

        const vote = movie.vote_average
          ? movie.vote_average.toFixed(1)
          : 'N/A';

        card.innerHTML = `
          <img
            class="movie-poster"
            src="${posterPath || ''}"
            alt="${movie.title || 'í¬ìŠ¤í„° ì—†ìŒ'} í¬ìŠ¤í„°"
            onerror="this.style.display='none';"
          />

          <div class="movie-body">
            <h2 class="movie-title">${movie.title || 'ì œëª© ì—†ìŒ'}</h2>

            <div class="movie-meta">
              <span>${releaseYear}</span>
              <span class="badge">
                <span class="badge-dot"></span>
                í‰ì  ${vote}
              </span>
            </div>

            <p class="movie-overview">
              ${movie.overview || 'ì¤„ê±°ë¦¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}
            </p>
          </div>
        `;

        moviesEl.appendChild(card);
      });
    }

    // TMDB ì¸ê¸° ì˜í™” ê°€ì ¸ì˜¤ê¸°
    async function fetchPopularMovies() {
      setStatus('ì¸ê¸° ì˜í™” ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
      try {
        const url = `${BASE_URL}/movie/popular?api_key=${API_KEY}&language=ko-KR&page=1`;
        const res = await fetch(url);

        if (!res.ok) {
          throw new Error('API ìš”ì²­ ì‹¤íŒ¨: ' + res.status);
        }

        const data = await res.json();
        // TMDB ì‘ë‹µ êµ¬ì¡°: { page, results: [...], total_pages, total_results }
        return data.results;
      } catch (err) {
        console.error(err);
        setStatus('ì—ëŸ¬ ë°œìƒ: ' + err.message);
        return [];
      }
    }

    // TMDB ê²€ìƒ‰ (ì œëª©ìœ¼ë¡œ ê²€ìƒ‰)
    async function searchMovies(query) {
      setStatus(`"${query}" ê²€ìƒ‰ ì¤‘...`);
      try {
        const url = `${BASE_URL}/search/movie?api_key=${API_KEY}&language=ko-KR&query=${encodeURIComponent(
          query
        )}&page=1&include_adult=false`;
        const res = await fetch(url);

        if (!res.ok) {
          throw new Error('API ìš”ì²­ ì‹¤íŒ¨: ' + res.status);
        }

        const data = await res.json();
        return data.results;
      } catch (err) {
        console.error(err);
        setStatus('ì—ëŸ¬ ë°œìƒ: ' + err.message);
        return [];
      }
    }

    // ========== ë²„íŠ¼ ì´ë²¤íŠ¸ë“¤ ==========

    // 1) ëœë¤ ì¸ê¸° ì˜í™” í•œ ê°œ ì¶”ì²œ
    randomBtn.addEventListener('click', async () => {
      const movies = await fetchPopularMovies();
      if (movies.length === 0) {
        renderMovies([]);
        return;
      }
      const randomIndex = Math.floor(Math.random() * movies.length);
      const randomMovie = movies[randomIndex];
      setStatus('ì¸ê¸° ì˜í™” ì¤‘ ëœë¤ìœ¼ë¡œ 1í¸ì„ ì¶”ì²œí•©ë‹ˆë‹¤.');
      renderMovies([randomMovie]);
    });

    // 2) ì¸ê¸° ì˜í™” 8ê°œ ë³´ì—¬ì£¼ê¸°
    popularBtn.addEventListener('click', async () => {
      const movies = await fetchPopularMovies();
      setStatus('í˜„ì¬ ì¸ê¸° ì˜í™” Top 8 ì…ë‹ˆë‹¤.');
      renderMovies(movies.slice(0, 8));
    });

    // 3) ê²€ìƒ‰
    searchBtn.addEventListener('click', async () => {
      const query = searchInput.value.trim();
      if (!query) {
        setStatus('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      const movies = await searchMovies(query);
      if (movies.length === 0) {
        setStatus(`"${query}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`);
      } else {
        setStatus(`"${query}" ê²€ìƒ‰ ê²°ê³¼ì…ë‹ˆë‹¤.`);
      }
      renderMovies(movies.slice(0, 12)); // ë„ˆë¬´ ë§ìœ¼ë©´ 12ê°œë§Œ
    });

    // Enterí‚¤ë¡œë„ ê²€ìƒ‰ ê°€ëŠ¥
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        searchBtn.click();
      }
    });

    // í˜ì´ì§€ ì²˜ìŒ ë¡œë“œ ì‹œ ì¸ê¸° ì˜í™” 8ê°œ ìë™ í‘œì‹œ
    window.addEventListener('DOMContentLoaded', async () => {
      const movies = await fetchPopularMovies();
      setStatus('í˜„ì¬ ì¸ê¸° ì˜í™” Top 8 ì…ë‹ˆë‹¤.');
      renderMovies(movies.slice(0, 8));
    });
  </script>
</body>
</html>
